<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bitwise Operations Unit Tests</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .header {
      background: #2d2d2d;
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .header h1 {
      margin: 0;
      font-size: 24px;
    }
    .console-output {
      background: #1a1a1a;
      color: #00ff00;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      max-height: 600px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .summary {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .summary h2 {
      margin-top: 0;
    }
    .stat {
      display: inline-block;
      margin-right: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    .pass { color: #4caf50; }
    .fail { color: #f44336; }
    .total { color: #2196f3; }
    button {
      background: #2196f3;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background: #1976d2;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Bitwise Operations Unit Tests</h1>
    <p>Multi-Mode Calculator - T-203 ビット演算テスト</p>
    <button onclick="location.reload()">再実行</button>
  </div>

  <div class="summary" id="summary">
    <h2>テスト結果</h2>
    <div id="stats"></div>
  </div>

  <h2>コンソール出力</h2>
  <div class="console-output" id="console"></div>

  <!-- Load Calculator modules -->
  <script src="../src/js/calculator.js"></script>
  <script src="../src/js/display.js"></script>
  <script src="../src/js/history.js"></script>

  <!-- Load and run tests -->
  <script src="bitwise.test.js"></script>

  <script>
    // Capture console output
    (function() {
      const consoleDiv = document.getElementById('console');
      const statsDiv = document.getElementById('stats');
      const originalLog = console.log;
      const originalError = console.error;

      console.log = function(...args) {
        originalLog.apply(console, args);
        const message = args.join(' ');
        consoleDiv.innerHTML += message + '\n';
      };

      console.error = function(...args) {
        originalError.apply(console, args);
        const message = args.join(' ');
        consoleDiv.innerHTML += '<span style="color: #ff6b6b;">' + message + '</span>\n';
      };

      // Display summary after tests complete
      setTimeout(() => {
        if (window.BitwiseTests && window.BitwiseTests.results) {
          const r = window.BitwiseTests.results;
          const passRate = ((r.passed / r.total) * 100).toFixed(2);

          statsDiv.innerHTML = `
            <span class="stat total">総テスト数: ${r.total}</span>
            <span class="stat pass">成功: ${r.passed}</span>
            <span class="stat fail">失敗: ${r.failed}</span>
            <span class="stat">成功率: ${passRate}%</span>
          `;

          if (r.failed === 0) {
            statsDiv.innerHTML += '<p style="color: #4caf50; font-weight: bold; margin-top: 10px;">✓ すべてのテストがパスしました！</p>';
          } else {
            statsDiv.innerHTML += '<p style="color: #f44336; font-weight: bold; margin-top: 10px;">✗ 一部のテストが失敗しました</p>';
          }
        }
      }, 500);
    })();
  </script>
</body>
</html>
