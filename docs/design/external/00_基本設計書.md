# 基本設計書

## 文書情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | Multi-Mode Calculator |
| 文書バージョン | 1.0 |
| 作成日 | 2025-12-11 |
| 最終更新日 | 2025-12-11 |
| 作成者 | Claude Code |

---

## 1. 設計概要

### 1.1 目的

本書は、Multi-Mode Calculatorの外部設計（基本設計）を記述する。ユーザー視点でシステムの振る舞いを定義し、実装フェーズへの橋渡しを行う。

### 1.2 対象読者

- 開発者
- デザイナー
- プロジェクトオーナー

### 1.3 関連ドキュメント

| ドキュメント | 参照先 |
|--------------|--------|
| 要件定義書 | docs/requirements/00_要件定義書.md |
| 機能要件定義書 | docs/requirements/02_機能要件定義書.md |
| 画面一覧（要件） | docs/requirements/04_画面一覧.md |

---

## 2. システム方針

### 2.1 設計方針

| 方針 | 説明 |
|------|------|
| シングルページアプリケーション | 画面遷移なしで全機能を提供 |
| オフラインファースト | サーバー通信なしで動作 |
| レスポンシブデザイン | PC・タブレット・スマートフォン対応 |
| アクセシビリティ | キーボード操作完全対応 |

### 2.2 アーキテクチャ概要

```
┌──────────────────────────────────────────────────────────┐
│                    ブラウザ                               │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  ┌────────────────┐  ┌────────────────┐                  │
│  │   HTML         │  │   CSS          │                  │
│  │   (構造)       │  │   (スタイル)    │                  │
│  └───────┬────────┘  └───────┬────────┘                  │
│          │                   │                           │
│          └─────────┬─────────┘                           │
│                    │                                     │
│          ┌─────────▼─────────┐                           │
│          │   JavaScript      │                           │
│          │   (動作・計算)    │                           │
│          └─────────┬─────────┘                           │
│                    │                                     │
│          ┌─────────▼─────────┐                           │
│          │  LocalStorage     │                           │
│          │  (設定・履歴保存) │                           │
│          └───────────────────┘                           │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

### 2.3 技術選定

| 技術 | 選定理由 |
|------|----------|
| HTML5 | 標準仕様、全ブラウザ対応 |
| CSS3 | カスタムプロパティでテーマ管理 |
| JavaScript (ES6+) | 外部ライブラリ不要、軽量 |
| LocalStorage | オフライン永続化 |

---

## 3. 機能構成

### 3.1 機能ブロック図

```
┌─────────────────────────────────────────────────────────────┐
│                 Multi-Mode Calculator                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                   表示レイヤー                       │   │
│  │  ┌───────────┐ ┌───────────┐ ┌───────────────────┐ │   │
│  │  │ディスプレイ│ │ボタンパッド│ │ サイドパネル     │ │   │
│  │  │  表示     │ │  表示     │ │（履歴・設定）    │ │   │
│  │  └───────────┘ └───────────┘ └───────────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                   制御レイヤー                       │   │
│  │  ┌───────────┐ ┌───────────┐ ┌───────────────────┐ │   │
│  │  │入力制御    │ │モード制御  │ │ テーマ制御       │ │   │
│  │  │（ボタン/KB)│ │（STD/SCI/ │ │ （10種類+       │ │   │
│  │  │           │ │  PRG）    │ │  ライト/ダーク） │ │   │
│  │  └───────────┘ └───────────┘ └───────────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                   処理レイヤー                       │   │
│  │  ┌───────────┐ ┌───────────┐ ┌───────────────────┐ │   │
│  │  │標準計算    │ │関数計算    │ │ プログラマ計算   │ │   │
│  │  │エンジン    │ │エンジン    │ │ エンジン        │ │   │
│  │  └───────────┘ └───────────┘ └───────────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                   永続化レイヤー                     │   │
│  │  ┌───────────────────────────────────────────────┐ │   │
│  │  │ LocalStorage（履歴・設定）                     │ │   │
│  │  └───────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 機能とモードの対応

| 機能カテゴリ | 標準 | 関数 | プログラマ |
|-------------|:----:|:----:|:----------:|
| 数値入力 | ○ | ○ | ○ |
| 四則演算 | ○ | ○ | ○ |
| パーセント | ○ | ○ | − |
| 三角関数 | − | ○ | − |
| 対数関数 | − | ○ | − |
| 累乗・ルート | ○ | ○ | − |
| 進数変換 | − | − | ○ |
| ビット演算 | − | − | ○ |
| ASCII変換 | − | − | ○ |

---

## 4. 画面構成

### 4.1 画面一覧

| 画面ID | 画面名 | 概要 | 対応要件 |
|--------|--------|------|----------|
| SCR-001 | メイン画面（標準電卓） | 標準電卓モード | FR-STD-* |
| SCR-002 | メイン画面（関数電卓） | 関数電卓モード | FR-SCI-* |
| SCR-003 | メイン画面（プログラマ電卓） | プログラマ電卓モード | FR-PRG-* |
| SCR-004 | 履歴パネル | 計算履歴表示 | FR-CMN-002, FR-CMN-003 |
| SCR-005 | テーマ設定ダイアログ | テーマ選択 | FR-CMN-004, FR-CMN-005 |
| SCR-006 | ASCII変換パネル | HEX⇔ASCII変換 | FR-PRG-005 |

### 4.2 レイアウト方針

```
【コンパクトヘッダー構成】
┌─────────────────────────────────────────────────────────────┐
│ [標準▼] [関数] [プログラマ]                  [☀️] [📜] [⚙️] │
│   ↑ アクティブモード強調                      ↑    ↑    ↑   │
│                                              │    │    └ テーマ設定（モーダル）
│                                              │    └ 履歴パネル（オーバーレイ）
│                                              └ ダークモード切替（ワンクリック）
└─────────────────────────────────────────────────────────────┘

【デスクトップ（1024px以上）】
┌─────────────────────────────────────────────────────────────┐
│ [標準] [関数] [プログラマ]                    [☀️] [📜] [⚙️] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                      ディスプレイ                            │
│  ┌───────────────────────────────────────────────────────┐ │
│  │                                                       │ │
│  │                                                 169   │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│                      ボタンエリア                            │
│  ┌───────────────────────────────────────────────────────┐ │
│  │                                                       │ │
│  │                    （電卓ボタン）                       │ │
│  │                                                       │ │
│  └───────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘

【タブレット（768px〜1023px）】
┌─────────────────────────────────────────────────────────────┐
│ [標準] [関数] [プログラマ]                    [☀️] [📜] [⚙️] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                      メイン電卓エリア                        │
│                      （ディスプレイ＋ボタン）                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘

【スマートフォン（767px以下）】
┌─────────────────────────────────────────────────────────────┐
│ [≡] Multi-Mode Calculator               [☀️] [📜] [⚙️]     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                      メイン電卓エリア                        │
│                      （フルスクリーン）                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
  ※ [≡]でモード選択ドロップダウン表示

【履歴パネル（オーバーレイ）】
  - 📜クリックで右からスライドイン
  - パネル外クリックで閉じる
  - 履歴クリアボタンあり

【テーマ設定（モーダル）】
  - ⚙️クリックでモーダル表示
  - テーマカード10種類をグリッド表示
  - 選択で即時適用（保存/キャンセル不要）
  - モーダル外クリックで閉じる
```

---

## 5. トレーサビリティマトリクス

### 5.1 機能要件と画面の対応

| 機能要件ID | 要件名 | 画面ID |
|-----------|--------|--------|
| FR-STD-001〜009 | 標準電卓機能 | SCR-001 |
| FR-SCI-001〜010 | 関数電卓機能 | SCR-002 |
| FR-PRG-001〜006 | プログラマ電卓機能 | SCR-003, SCR-006 |
| FR-CMN-001 | モード切り替え | SCR-001, SCR-002, SCR-003 |
| FR-CMN-002 | 計算履歴表示 | SCR-004 |
| FR-CMN-003 | 履歴クリア | SCR-004 |
| FR-CMN-004 | テーマ選択 | SCR-005 |
| FR-CMN-005 | ライト/ダークモード | SCR-005 |
| FR-CMN-006 | キーボードショートカット | 全画面 |
| FR-CMN-007 | 設定永続化 | 全画面 |
| FR-CMN-008 | レスポンシブ対応 | 全画面 |

---

## 6. データ設計

### 6.1 LocalStorage データ構造

| キー | 型 | 説明 | 初期値 |
|------|-----|------|--------|
| calc_theme | string | 選択中のテーマ名 | "default" |
| calc_darkMode | boolean | ダークモード有効 | false |
| calc_lastMode | string | 最後に使用したモード | "standard" |
| calc_angleMode | string | 角度モード（DEG/RAD） | "DEG" |
| calc_bitLength | string | ビット長設定 | "DWORD" |
| calc_history | array | 計算履歴（最大100件） | [] |

### 6.2 履歴データ構造

```json
{
  "id": "uuid",
  "timestamp": "2025-12-11T10:30:00Z",
  "mode": "standard",
  "expression": "12 + 8",
  "result": "20"
}
```

---

## 7. 関連ドキュメント一覧

| ドキュメント | ファイルパス |
|--------------|-------------|
| システム構成図 | 01_システム構成図.md |
| 画面一覧 | 02_画面一覧.md |
| 画面設計書 | 03_画面設計書/ |
| 画面遷移図 | 04_画面遷移図.md |
| メッセージ一覧 | 05_メッセージ一覧.md |

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|------------|----------|--------|
| 2025-12-11 | 1.0 | 初版作成 | Claude Code |
