# 画面設計書: SCR-004 履歴パネル

## 基本情報

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-004 |
| 画面名 | 履歴パネル |
| 対応機能要件 | FR-CMN-002, FR-CMN-003 |
| 作成日 | 2025-12-11 |
| 更新日 | 2025-12-11 |
| 作成者 | Claude Code |

---

## 画面レイアウト

```
┌─────────────────────────────────────┐
│  履歴                          [×]  │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 12 + 8 = 20                  │   │ ← クリック可能
│  │ 2025-12-11 10:30             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 100 × 5 = 500                │   │
│  │ 2025-12-11 10:28             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ sin(90°) = 1                 │   │
│  │ 2025-12-11 10:25             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ FF (HEX) = 255 (DEC)         │   │
│  │ 2025-12-11 10:20             │   │
│  └─────────────────────────────┘   │
│                                     │
│         ... (スクロール)            │
│                                     │
├─────────────────────────────────────┤
│  [🗑 履歴をクリア]                  │
└─────────────────────────────────────┘
```

---

## 画面項目一覧

### ヘッダー

| No | 項目ID | 項目名 | 種別 | 説明 |
|----|--------|--------|------|------|
| 1 | SCR004_lbl_title | タイトル | ラベル | 「履歴」を表示 |
| 2 | SCR004_btn_close | 閉じるボタン | ボタン | パネルを閉じる |

### 履歴リスト

| No | 項目ID | 項目名 | 種別 | 説明 |
|----|--------|--------|------|------|
| 3 | SCR004_list_history | 履歴リスト | リスト | 計算履歴の一覧 |
| 4 | SCR004_item_history | 履歴項目 | リスト項目 | 個別の計算履歴（動的生成） |

### フッター

| No | 項目ID | 項目名 | 種別 | 説明 |
|----|--------|--------|------|------|
| 5 | SCR004_btn_clear | クリアボタン | ボタン | 全履歴を削除 |

---

## 履歴項目の詳細

### 項目構成

| 要素 | 説明 | 例 |
|------|------|-----|
| 計算式 | 実行した計算式 | 12 + 8 |
| 結果 | 計算結果 | 20 |
| タイムスタンプ | 計算日時 | 2025-12-11 10:30 |
| モード表示 | プログラマ電卓の場合、進数を表示 | FF (HEX) |

### モード別表示形式

| モード | 表示形式 | 例 |
|--------|----------|-----|
| 標準電卓 | {式} = {結果} | 12 + 8 = 20 |
| 関数電卓 | {関数}({引数}) = {結果} | sin(90°) = 1 |
| プログラマ電卓 | {値} ({進数}) = {値} ({進数}) | FF (HEX) = 255 (DEC) |

---

## アクション定義

### 履歴項目操作

| No | トリガー | アクション | 結果 |
|----|---------|-----------|------|
| 1 | 履歴項目クリック | 計算結果を電卓のディスプレイに反映 | ディスプレイが結果値に更新 |
| 2 | 履歴項目ホバー | ホバー状態を視覚的に表示 | 背景色変更 |

### パネル操作

| No | トリガー | アクション | 結果 |
|----|---------|-----------|------|
| 3 | 閉じるボタン押下 | パネルを非表示 | パネルが閉じる |
| 4 | パネル外クリック | パネルを非表示（モバイル時） | パネルが閉じる |

### 履歴クリア

| No | トリガー | アクション | 結果 |
|----|---------|-----------|------|
| 5 | クリアボタン押下 | 確認ダイアログを表示 | 確認メッセージ表示 |
| 6 | 確認ダイアログで「はい」 | 全履歴を削除、LocalStorage更新 | 履歴リストが空になる |
| 7 | 確認ダイアログで「いいえ」 | 何もしない | ダイアログが閉じる |

---

## 履歴データ構造

### LocalStorage保存形式

```json
{
  "calc_history": [
    {
      "id": "uuid-1234-5678",
      "timestamp": "2025-12-11T10:30:00.000Z",
      "mode": "standard",
      "expression": "12 + 8",
      "result": "20"
    },
    {
      "id": "uuid-2345-6789",
      "timestamp": "2025-12-11T10:28:00.000Z",
      "mode": "scientific",
      "expression": "sin(90°)",
      "result": "1"
    },
    {
      "id": "uuid-3456-7890",
      "timestamp": "2025-12-11T10:20:00.000Z",
      "mode": "programmer",
      "expression": "FF",
      "result": "255",
      "inputBase": "HEX",
      "outputBase": "DEC"
    }
  ]
}
```

### データ項目

| 項目 | 型 | 説明 |
|------|-----|------|
| id | string | 一意識別子（UUID） |
| timestamp | string | ISO 8601形式のタイムスタンプ |
| mode | string | "standard" \| "scientific" \| "programmer" |
| expression | string | 計算式 |
| result | string | 計算結果 |
| inputBase | string | 入力進数（プログラマのみ） |
| outputBase | string | 出力進数（プログラマのみ） |

---

## 表示仕様

### 履歴件数

| 項目 | 値 |
|------|-----|
| 最大保存件数 | 100件 |
| 表示順 | 新しい順（降順） |
| 超過時の動作 | 最も古い履歴を削除 |

### レスポンシブ対応

| 画面サイズ | パネル表示 |
|-----------|-----------|
| デスクトップ（1024px以上） | サイドに常時表示（トグル可） |
| タブレット（768px〜1023px） | 下部に折りたたみ表示 |
| スマートフォン（767px以下） | オーバーレイで全画面表示 |

---

## エラーハンドリング

| 状態 | 表示 |
|------|------|
| 履歴が空 | 「履歴がありません」メッセージ |
| LocalStorage読み込みエラー | 空の履歴リストを表示 |
| LocalStorage書き込みエラー | コンソールにエラーログ（UIには影響なし） |

---

## 補足事項

1. **履歴の自動追加**: 計算完了時（=押下時）に自動で履歴に追加
2. **値の再利用**: 履歴項目をクリックすると、結果値が現在のディスプレイに入力される
3. **スクロール**: 履歴が多い場合は縦スクロールで表示
4. **永続化**: 履歴はLocalStorageに保存され、ブラウザを閉じても保持される

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|------------|----------|--------|
| 2025-12-11 | 1.0 | 初版作成 | Claude Code |
