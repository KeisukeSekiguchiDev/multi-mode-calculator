# 画面設計書: SCR-001 標準電卓

## 基本情報

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-001 |
| 画面名 | メイン画面（標準電卓） |
| 対応機能要件 | FR-STD-001〜009, FR-CMN-001, 006, 007, 008 |
| 作成日 | 2025-12-11 |
| 更新日 | 2025-12-11 |
| 作成者 | Claude Code |

---

## 画面レイアウト

### 全体構成

```
┌─────────────────────────────────────────────────────────────────┐
│                     コンパクトヘッダーエリア                       │
│  ┌──────────────────────────────┐         ┌────┐┌────┐┌────┐  │
│  │ [標準▼] [関数] [プログラマ]   │         │ ☀️ ││ 📜 ││ ⚙️ │  │
│  │   ↑アクティブ                │         └────┘└────┘└────┘  │
│  └──────────────────────────────┘          ↑     ↑     ↑      │
│                                          ダーク 履歴  設定     │
├─────────────────────────────────────────────────────────────────┤
│                        ディスプレイエリア                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                            12 + 8 =     │   │ ← 計算式
│  │                                                         │   │
│  │                                                    20   │   │ ← 結果
│  └─────────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────┤
│                         ボタンエリア                             │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                         │   │
│  │   [ % ]    [ CE ]    [ C ]    [ ⌫ ]                     │   │
│  │                                                         │   │
│  │   [1/x]    [ x² ]    [ √x ]   [ ÷ ]                     │   │
│  │                                                         │   │
│  │   [ 7 ]    [ 8 ]     [ 9 ]    [ × ]                     │   │
│  │                                                         │   │
│  │   [ 4 ]    [ 5 ]     [ 6 ]    [ − ]                     │   │
│  │                                                         │   │
│  │   [ 1 ]    [ 2 ]     [ 3 ]    [ + ]                     │   │
│  │                                                         │   │
│  │   [ ± ]    [ 0 ]     [ . ]    [ = ]                     │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 画面項目一覧

### コンパクトヘッダーエリア

| No | 項目ID | 項目名 | 種別 | 説明 |
|----|--------|--------|------|------|
| 1 | SCR001_tab_001 | 標準タブ | タブ | 標準電卓モード選択（アクティブ状態、下線強調） |
| 2 | SCR001_tab_002 | 関数タブ | タブ | 関数電卓モードへ切り替え |
| 3 | SCR001_tab_003 | プログラマタブ | タブ | プログラマ電卓モードへ切り替え |
| 4 | SCR001_btn_darkmode | ダークモード切替 | アイコンボタン | ☀️/🌙 ワンクリックでライト/ダーク切替 |
| 5 | SCR001_btn_history | 履歴パネル | アイコンボタン | 📜 クリックで履歴パネルをスライドイン表示 |
| 6 | SCR001_btn_settings | テーマ設定 | アイコンボタン | ⚙️ クリックでテーマ設定モーダル表示 |

### ディスプレイエリア

| No | 項目ID | 項目名 | 種別 | 初期値 | 最大長 | 備考 |
|----|--------|--------|------|--------|--------|------|
| 6 | SCR001_lbl_expression | 計算式表示 | ラベル | （空白） | 50文字 | 右寄せ表示 |
| 7 | SCR001_lbl_result | 結果表示 | ラベル | 0 | 15桁 | 右寄せ、大きいフォント |

### ボタンエリア（上段：機能ボタン）

| No | 項目ID | 項目名 | 種別 | 表示 | キーボード |
|----|--------|--------|------|------|-----------|
| 8 | SCR001_btn_percent | パーセント | ボタン | % | % |
| 9 | SCR001_btn_ce | クリアエントリー | ボタン | CE | Delete |
| 10 | SCR001_btn_c | クリア | ボタン | C | Escape |
| 11 | SCR001_btn_backspace | バックスペース | ボタン | ⌫ | Backspace |

### ボタンエリア（関数ボタン）

| No | 項目ID | 項目名 | 種別 | 表示 | 機能 |
|----|--------|--------|------|------|------|
| 12 | SCR001_btn_reciprocal | 逆数 | ボタン | 1/x | 1÷現在値 |
| 13 | SCR001_btn_square | 2乗 | ボタン | x² | 現在値² |
| 14 | SCR001_btn_sqrt | 平方根 | ボタン | √x | √現在値 |
| 15 | SCR001_btn_divide | 除算 | ボタン | ÷ | / |

### ボタンエリア（数字・演算子ボタン）

| No | 項目ID | 項目名 | 種別 | 表示 | キーボード |
|----|--------|--------|------|------|-----------|
| 16 | SCR001_btn_7 | 数字7 | ボタン | 7 | 7 |
| 17 | SCR001_btn_8 | 数字8 | ボタン | 8 | 8 |
| 18 | SCR001_btn_9 | 数字9 | ボタン | 9 | 9 |
| 19 | SCR001_btn_multiply | 乗算 | ボタン | × | * |
| 20 | SCR001_btn_4 | 数字4 | ボタン | 4 | 4 |
| 21 | SCR001_btn_5 | 数字5 | ボタン | 5 | 5 |
| 22 | SCR001_btn_6 | 数字6 | ボタン | 6 | 6 |
| 23 | SCR001_btn_subtract | 減算 | ボタン | − | - |
| 24 | SCR001_btn_1 | 数字1 | ボタン | 1 | 1 |
| 25 | SCR001_btn_2 | 数字2 | ボタン | 2 | 2 |
| 26 | SCR001_btn_3 | 数字3 | ボタン | 3 | 3 |
| 27 | SCR001_btn_add | 加算 | ボタン | + | + |
| 28 | SCR001_btn_negate | 符号反転 | ボタン | ± | （なし） |
| 29 | SCR001_btn_0 | 数字0 | ボタン | 0 | 0 |
| 30 | SCR001_btn_decimal | 小数点 | ボタン | . | . |
| 31 | SCR001_btn_equals | イコール | ボタン | = | Enter |

---

## アクション定義

### 数字入力

| No | トリガー | アクション | 条件 |
|----|---------|-----------|------|
| 1 | 数字ボタン押下（0-9） | ディスプレイに数字を追加表示 | 桁数15桁未満 |
| 2 | 数字ボタン押下（0-9） | 入力を無視 | 桁数15桁以上 |
| 3 | 小数点押下 | ディスプレイに小数点を追加 | 小数点未入力時 |
| 4 | 小数点押下 | 入力を無視 | 小数点入力済み時 |

### 演算子入力

| No | トリガー | アクション | 条件 |
|----|---------|-----------|------|
| 5 | 演算子ボタン押下（＋−×÷） | 現在値を左辺として保持、演算子を設定 | - |
| 6 | 連続演算子押下 | 演算子を置換 | 前回入力が演算子 |

### 計算実行

| No | トリガー | アクション | 結果 |
|----|---------|-----------|------|
| 7 | イコール押下 | 計算を実行、結果を表示 | 正常計算 |
| 8 | イコール押下 | 「Error」を表示 | ゼロ除算時 |
| 9 | イコール押下 | 計算履歴に追加 | 計算完了時 |

### クリア操作

| No | トリガー | アクション |
|----|---------|-----------|
| 10 | Cボタン押下 | 全てクリア（ディスプレイ、左辺、演算子） |
| 11 | CEボタン押下 | 現在の入力のみクリア（左辺、演算子は維持） |
| 12 | バックスペース押下 | 最後の1文字を削除 |

### 即時計算

| No | トリガー | アクション |
|----|---------|-----------|
| 13 | パーセント押下 | 現在値÷100を表示 |
| 14 | 逆数押下 | 1÷現在値を表示 |
| 15 | 2乗押下 | 現在値²を表示 |
| 16 | 平方根押下 | √現在値を表示 |
| 17 | 符号反転押下 | 現在値の符号を反転 |

---

## バリデーションルール

| 項目ID | ルール | エラー時の動作 |
|--------|--------|----------------|
| 数字入力 | 最大15桁 | 入力を無視 |
| 小数点 | 1つのみ | 入力を無視 |
| 平方根 | 負の数不可 | 「Error」表示 |
| 除算 | ゼロ除算不可 | 「Error」表示 |
| 逆数 | ゼロ不可 | 「Error」表示 |

---

## エラーハンドリング

| エラーコード | 発生条件 | メッセージ | 対処 |
|-------------|---------|-----------|------|
| ERR-001 | ゼロで除算 | Error | Cボタンでクリア |
| ERR-002 | 負の数の平方根 | Error | Cボタンでクリア |
| ERR-003 | 結果がInfinity | Infinity | Cボタンでクリア |
| ERR-004 | 結果がNaN | Error | Cボタンでクリア |

---

## キーボードショートカット一覧

| キー | 機能 |
|------|------|
| 0-9 | 数字入力 |
| . | 小数点 |
| + | 加算 |
| - | 減算 |
| * | 乗算 |
| / | 除算 |
| Enter | 計算実行 |
| Backspace | 1文字削除 |
| Escape | 全クリア（C） |
| Delete | クリアエントリー（CE） |
| % | パーセント |

---

## 状態遷移

```
┌─────────────────────────────────────────────────────────────┐
│                      状態遷移図                              │
└─────────────────────────────────────────────────────────────┘

    ┌─────────┐
    │ 初期状態 │
    │  "0"    │
    └────┬────┘
         │ 数字入力
         ▼
    ┌─────────┐
    │ 数値入力 │ ←──────────────┐
    │  中     │                │
    └────┬────┘                │
         │ 演算子入力           │
         ▼                     │
    ┌─────────┐                │
    │ 演算子  │                │
    │ 入力済み│                │
    └────┬────┘                │
         │ 数字入力            │
         ▼                     │
    ┌─────────┐                │
    │ 右辺    │                │
    │ 入力中  │                │
    └────┬────┘                │
         │ イコール押下        │
         ▼                     │
    ┌─────────┐                │
    │ 結果表示│ ───演算子入力──┘
    └────┬────┘
         │ Cボタン or 数字入力
         ▼
    ┌─────────┐
    │ 初期状態 │
    └─────────┘
```

---

## 補足事項

1. **連続計算**: 計算結果に対して続けて演算が可能（例: 5+3=8, +2=10）
2. **フォーカス管理**: ボタンクリック後もキーボード入力を受け付ける
3. **表示更新**: 入力のたびに即座にディスプレイを更新
4. **履歴連携**: 計算完了時に自動で履歴パネル（SCR-004）に追加

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|------------|----------|--------|
| 2025-12-11 | 1.0 | 初版作成 | Claude Code |
