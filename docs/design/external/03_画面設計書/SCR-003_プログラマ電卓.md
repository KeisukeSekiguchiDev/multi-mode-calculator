# 画面設計書: SCR-003 プログラマ電卓

## 基本情報

| 項目 | 内容 |
|------|------|
| 画面ID | SCR-003 |
| 画面名 | メイン画面（プログラマ電卓） |
| 対応機能要件 | FR-PRG-001〜006, FR-CMN-001, 006, 007, 008 |
| 作成日 | 2025-12-11 |
| 更新日 | 2025-12-11 |
| 作成者 | Claude Code |

---

## 画面レイアウト

```
┌─────────────────────────────────────────────────────────────────────┐
│                     コンパクトヘッダーエリア                          │
│  ┌────────────────────────────────┐       ┌────┐┌────┐┌────┐      │
│  │ [標準] [関数] [プログラマ▼]     │       │ ☀️ ││ 📜 ││ ⚙️ │      │
│  │                 ↑アクティブ    │       └────┘└────┘└────┘      │
│  └────────────────────────────────┘        ↑     ↑     ↑          │
│                                          ダーク 履歴  設定         │
├─────────────────────────────────────────────────────────────────────┤
│  ビット長: [BYTE] [WORD] [DWORD●] [QWORD]                          │
├─────────────────────────────────────────────────────────────────────┤
│                      進数同時表示エリア                              │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  HEX:  FF                                                   │   │
│  │  DEC:  255                                                  │   │
│  │  OCT:  377                                                  │   │
│  │  BIN:  1111 1111                                            │   │
│  └─────────────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────────┤
│  入力モード: ○HEX  ●DEC  ○OCT  ○BIN                               │
├─────────────────────────────────────────────────────────────────────┤
│                         ボタンエリア                                 │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  [AND]  [OR]   [XOR]  [NOT]  [<<]  [>>]  [CE]  [C]  [⌫]    │   │
│  │  [A]    [B]    [C]    [D]    [E]   [F]         [÷]         │   │
│  │  [7]    [8]    [9]                             [×]         │   │
│  │  [4]    [5]    [6]                             [−]         │   │
│  │  [1]    [2]    [3]                             [+]         │   │
│  │  [±]    [0]           [ASCII]                  [=]         │   │
│  └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 画面項目一覧

### ビット長選択

| No | 項目ID | 項目名 | 種別 | 初期値 | 備考 |
|----|--------|--------|------|--------|------|
| 1 | SCR003_btn_byte | BYTE | トグル | 非選択 | 8ビット（0〜255） |
| 2 | SCR003_btn_word | WORD | トグル | 非選択 | 16ビット（0〜65,535） |
| 3 | SCR003_btn_dword | DWORD | トグル | 選択 | 32ビット（0〜4,294,967,295） |
| 4 | SCR003_btn_qword | QWORD | トグル | 非選択 | 64ビット |

### 進数同時表示

| No | 項目ID | 項目名 | 種別 | 備考 |
|----|--------|--------|------|------|
| 5 | SCR003_lbl_hex | HEX表示 | ラベル | 16進数表示 |
| 6 | SCR003_lbl_dec | DEC表示 | ラベル | 10進数表示 |
| 7 | SCR003_lbl_oct | OCT表示 | ラベル | 8進数表示 |
| 8 | SCR003_lbl_bin | BIN表示 | ラベル | 2進数表示（4桁区切り） |

### 入力モード選択

| No | 項目ID | 項目名 | 種別 | 初期値 | 有効ボタン |
|----|--------|--------|------|--------|-----------|
| 9 | SCR003_rb_hex | HEX | ラジオ | 非選択 | 0-9, A-F |
| 10 | SCR003_rb_dec | DEC | ラジオ | 選択 | 0-9 |
| 11 | SCR003_rb_oct | OCT | ラジオ | 非選択 | 0-7 |
| 12 | SCR003_rb_bin | BIN | ラジオ | 非選択 | 0-1 |

### ビット演算ボタン

| No | 項目ID | 項目名 | 表示 | 機能 |
|----|--------|--------|------|------|
| 13 | SCR003_btn_and | 論理積 | AND | A AND B |
| 14 | SCR003_btn_or | 論理和 | OR | A OR B |
| 15 | SCR003_btn_xor | 排他的論理和 | XOR | A XOR B |
| 16 | SCR003_btn_not | 否定 | NOT | NOT A |
| 17 | SCR003_btn_lshift | 左シフト | << | A << n |
| 18 | SCR003_btn_rshift | 右シフト | >> | A >> n |

### 16進数ボタン

| No | 項目ID | 項目名 | 表示 | 有効条件 |
|----|--------|--------|------|----------|
| 19 | SCR003_btn_a | 16進数A | A | HEXモード時 |
| 20 | SCR003_btn_b | 16進数B | B | HEXモード時 |
| 21 | SCR003_btn_c | 16進数C | C | HEXモード時 |
| 22 | SCR003_btn_d | 16進数D | D | HEXモード時 |
| 23 | SCR003_btn_e | 16進数E | E | HEXモード時 |
| 24 | SCR003_btn_f | 16進数F | F | HEXモード時 |

### ASCII変換ボタン

| No | 項目ID | 項目名 | 表示 | 機能 |
|----|--------|--------|------|------|
| 25 | SCR003_btn_ascii | ASCII変換 | ASCII | SCR-006を表示 |

---

## アクション定義

### 進数入力

| No | トリガー | アクション | 条件 |
|----|---------|-----------|------|
| 1 | 数字入力 | 選択中の進数で値を追加 | 有効な文字のみ |
| 2 | 進数モード切替 | 入力モードを変更、ボタン有効/無効を更新 | - |
| 3 | 値入力 | 全進数表示を同時更新 | - |

### ビット演算

| No | トリガー | アクション | 条件 |
|----|---------|-----------|------|
| 4 | AND押下 | 左辺と右辺のANDを計算 | 2つの値入力済み |
| 5 | OR押下 | 左辺と右辺のORを計算 | 2つの値入力済み |
| 6 | XOR押下 | 左辺と右辺のXORを計算 | 2つの値入力済み |
| 7 | NOT押下 | 現在値のビット反転 | ビット長に応じた反転 |
| 8 | <<押下 | 次の入力分左シフト | - |
| 9 | >>押下 | 次の入力分右シフト | - |

### ビット長変更

| No | トリガー | アクション |
|----|---------|-----------|
| 10 | BYTE選択 | 値を8ビットに制限（& 0xFF） |
| 11 | WORD選択 | 値を16ビットに制限（& 0xFFFF） |
| 12 | DWORD選択 | 値を32ビットに制限（& 0xFFFFFFFF） |
| 13 | QWORD選択 | 値を64ビットに制限 |

### ボタン有効/無効制御

| 入力モード | 有効なボタン |
|-----------|-------------|
| HEX | 0-9, A-F |
| DEC | 0-9 |
| OCT | 0-7 |
| BIN | 0-1 |

---

## 進数変換ロジック

### 入力値の内部保持

- 全ての値は内部的に10進数（JavaScript Number）で保持
- 表示時に各進数に変換

### 変換式

```javascript
// 10進数 → 各進数（表示用）
hex = value.toString(16).toUpperCase();
dec = value.toString(10);
oct = value.toString(8);
bin = value.toString(2);

// 各進数 → 10進数（入力用）
value = parseInt(inputString, base); // base = 2, 8, 10, 16
```

### 2進数表示フォーマット

- 4桁ごとにスペース区切り
- 例: `1111 1111 0000 0000`

---

## ビット演算の詳細

### NOT演算（ビット反転）

ビット長に応じたマスクを適用:

| ビット長 | マスク | NOT(0)の結果 |
|----------|--------|-------------|
| BYTE | 0xFF | 255 |
| WORD | 0xFFFF | 65,535 |
| DWORD | 0xFFFFFFFF | 4,294,967,295 |
| QWORD | 0xFFFFFFFFFFFFFFFF | 18,446,744,073,709,551,615 |

### シフト演算

| 演算 | 動作 | 例（8ビット） |
|------|------|-------------|
| 左シフト | ビットを左にn個移動、右端に0を埋める | 0001 << 2 = 0100 |
| 右シフト | ビットを右にn個移動、左端に0を埋める | 1000 >> 2 = 0010 |

---

## バリデーションルール

| 項目 | ルール | エラー時の動作 |
|------|--------|----------------|
| 入力文字 | 選択中の進数で有効な文字のみ | 入力を無視 |
| 値の範囲 | ビット長の最大値以下 | オーバーフロー処理 |
| シフト量 | 0〜ビット長の範囲 | 入力を無視 |

---

## エラーハンドリング

| エラーコード | 発生条件 | メッセージ |
|-------------|---------|-----------|
| ERR-PRG-001 | オーバーフロー | 上位ビットを切り捨て |
| ERR-PRG-002 | 無効な文字入力 | 入力を無視（エラー表示なし） |

---

## 補足事項

1. **進数同時表示**: 入力のたびに4つの進数表示を即座に更新
2. **オーバーフロー**: ビット長を超える値は自動的にマスク処理
3. **負の数**: 現バージョンでは符号なし整数のみ対応
4. **QWORD制限**: JavaScriptのNumber精度制限（53ビット）に注意

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|------------|----------|--------|
| 2025-12-11 | 1.0 | 初版作成 | Claude Code |
