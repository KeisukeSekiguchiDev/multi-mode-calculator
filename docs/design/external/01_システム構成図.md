# システム構成図

## 文書情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | Multi-Mode Calculator |
| 文書バージョン | 1.0 |
| 作成日 | 2025-12-11 |
| 最終更新日 | 2025-12-11 |

---

## 1. システム全体構成

### 1.1 概要図

```
┌─────────────────────────────────────────────────────────────────────┐
│                           ユーザー                                   │
│                       （PC / タブレット / スマートフォン）             │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ ブラウザアクセス
                                    │ （ローカルファイル or Webサーバー）
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        Webブラウザ                                   │
│                   （Chrome / Firefox / Edge / Safari）               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   ┌───────────────────────────────────────────────────────────┐    │
│   │              Multi-Mode Calculator                         │    │
│   │                                                           │    │
│   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐   │    │
│   │  │   HTML5     │  │    CSS3     │  │   JavaScript    │   │    │
│   │  │             │  │             │  │    (ES6+)       │   │    │
│   │  │  index.html │  │  main.css   │  │   main.js       │   │    │
│   │  │             │  │  themes.css │  │   calculator.js │   │    │
│   │  │             │  │  responsive │  │   display.js    │   │    │
│   │  │             │  │   .css      │  │   history.js    │   │    │
│   │  │             │  │             │  │   themes.js     │   │    │
│   │  │             │  │             │  │   keyboard.js   │   │    │
│   │  └─────────────┘  └─────────────┘  └─────────────────┘   │    │
│   │                                                           │    │
│   └───────────────────────────────────────────────────────────┘    │
│                                    │                                │
│                                    │                                │
│   ┌───────────────────────────────────────────────────────────┐    │
│   │                    LocalStorage                            │    │
│   │                                                           │    │
│   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐   │    │
│   │   │  テーマ設定  │  │  履歴データ  │  │   モード設定    │   │    │
│   │   │  calc_theme │  │calc_history │  │ calc_lastMode  │   │    │
│   │   │calc_darkMode│  │  (100件)    │  │ calc_angleMode │   │    │
│   │   └─────────────┘  └─────────────┘  └─────────────────┘   │    │
│   │                                                           │    │
│   └───────────────────────────────────────────────────────────┘    │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 2. ファイル構成

### 2.1 ディレクトリ構成

```
Calculator/
├── index.html              # エントリーポイント（メインHTML）
├── src/
│   ├── css/
│   │   ├── main.css        # 基本スタイル定義
│   │   ├── themes.css      # テーマ変数定義
│   │   └── responsive.css  # レスポンシブ対応
│   ├── js/
│   │   ├── main.js         # アプリケーション初期化
│   │   ├── calculator.js   # 計算エンジン
│   │   ├── display.js      # ディスプレイ制御
│   │   ├── history.js      # 履歴管理
│   │   ├── themes.js       # テーマ制御
│   │   └── keyboard.js     # キーボードイベント
│   └── themes/
│       └── (テーマ別追加CSS)
├── docs/
│   ├── requirements/       # 要件定義書
│   └── design/
│       └── external/       # 外部設計書（このファイル）
└── .claude/
    └── CLAUDE.md           # プロジェクトガイド
```

### 2.2 ファイル役割一覧

| ファイル | 役割 | 依存関係 |
|----------|------|----------|
| index.html | DOM構造定義、全リソース読み込み | - |
| main.css | レイアウト、共通スタイル | - |
| themes.css | CSSカスタムプロパティ（10テーマ×2モード） | main.css |
| responsive.css | ブレークポイント別スタイル | main.css |
| main.js | 初期化、イベントバインド | 全js |
| calculator.js | 計算ロジック（全モード） | - |
| display.js | ディスプレイ更新 | calculator.js |
| history.js | 履歴CRUD、LocalStorage操作 | - |
| themes.js | テーマ切り替え、LocalStorage操作 | - |
| keyboard.js | キーボードイベントハンドリング | calculator.js, display.js |

---

## 3. コンポーネント構成

### 3.1 UIコンポーネント階層

```
┌─────────────────────────────────────────────────────────────────────┐
│                          App (ルート)                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │                        Header                                  │ │
│  │  ┌─────────────┐  ┌─────────────────┐  ┌────────────────────┐│ │
│  │  │ ModeTabBar  │  │ ThemeToggle     │  │ SettingsButton    ││ │
│  │  │ (3タブ)     │  │ (ライト/ダーク) │  │                    ││ │
│  │  └─────────────┘  └─────────────────┘  └────────────────────┘│ │
│  └───────────────────────────────────────────────────────────────┘ │
│                                                                     │
│  ┌────────────────────────────────────┐  ┌───────────────────────┐│
│  │           MainArea                  │  │    SidePanel          ││
│  │                                    │  │                       ││
│  │  ┌──────────────────────────────┐ │  │  ┌───────────────────┐││
│  │  │         Display              │ │  │  │   HistoryPanel    │││
│  │  │  ┌────────────────────────┐  │ │  │  │                   │││
│  │  │  │ ExpressionDisplay     │  │ │  │  │  ┌─────────────┐  │││
│  │  │  │ (計算式表示)          │  │ │  │  │  │HistoryItem │  │││
│  │  │  └────────────────────────┘  │ │  │  │  │ (履歴1件)  │  │││
│  │  │  ┌────────────────────────┐  │ │  │  │  └─────────────┘  │││
│  │  │  │ ResultDisplay         │  │ │  │  │       ...         │││
│  │  │  │ (結果表示)            │  │ │  │  │  ┌─────────────┐  │││
│  │  │  └────────────────────────┘  │ │  │  │  │ClearButton │  │││
│  │  │  ┌────────────────────────┐  │ │  │  │  └─────────────┘  │││
│  │  │  │ SubDisplay            │  │ │  │  └───────────────────┘││
│  │  │  │ (進数表示/角度モード) │  │ │  │                       ││
│  │  │  └────────────────────────┘  │ │  └───────────────────────┘│
│  │  └──────────────────────────────┘ │                           │
│  │                                    │                           │
│  │  ┌──────────────────────────────┐ │                           │
│  │  │         ButtonPad            │ │                           │
│  │  │  ┌────┐ ┌────┐ ┌────┐ ┌────┐│ │                           │
│  │  │  │Btn │ │Btn │ │Btn │ │Btn ││ │                           │
│  │  │  └────┘ └────┘ └────┘ └────┘│ │                           │
│  │  │  ┌────┐ ┌────┐ ┌────┐ ┌────┐│ │                           │
│  │  │  │Btn │ │Btn │ │Btn │ │Btn ││ │                           │
│  │  │  └────┘ └────┘ └────┘ └────┘│ │                           │
│  │  │          ...                 │ │                           │
│  │  └──────────────────────────────┘ │                           │
│  └────────────────────────────────────┘                           │
│                                                                     │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │                      Modal (オーバーレイ)                      │ │
│  │  ┌─────────────────────┐  ┌─────────────────────────────────┐│ │
│  │  │ ThemeSettingsDialog │  │ AsciiConverterPanel             ││ │
│  │  │ (テーマ選択)         │  │ (ASCII変換)                     ││ │
│  │  └─────────────────────┘  └─────────────────────────────────┘│ │
│  └───────────────────────────────────────────────────────────────┘ │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. データフロー

### 4.1 計算処理フロー

```
┌──────────────────────────────────────────────────────────────────────┐
│                           計算処理フロー                              │
└──────────────────────────────────────────────────────────────────────┘

┌─────────┐     ┌─────────────┐     ┌──────────────┐     ┌──────────┐
│ ユーザー │────▶│ 入力イベント │────▶│ Calculator   │────▶│ Display  │
│ 入力    │     │ (ボタン/KB) │     │ (計算処理)   │     │ (表示)   │
└─────────┘     └─────────────┘     └──────────────┘     └──────────┘
                                           │
                                           │ 計算完了時
                                           ▼
                                    ┌──────────────┐
                                    │   History    │
                                    │ (履歴保存)   │
                                    └──────────────┘
                                           │
                                           │ LocalStorage
                                           ▼
                                    ┌──────────────┐
                                    │ LocalStorage │
                                    │  永続化      │
                                    └──────────────┘
```

### 4.2 テーマ切り替えフロー

```
┌─────────┐     ┌──────────────┐     ┌──────────────┐     ┌──────────┐
│ ユーザー │────▶│ テーマ選択   │────▶│   Themes     │────▶│   CSS    │
│ 操作    │     │ ダイアログ   │     │ (テーマ適用) │     │ 変数更新 │
└─────────┘     └──────────────┘     └──────────────┘     └──────────┘
                                           │
                                           │ 設定保存
                                           ▼
                                    ┌──────────────┐
                                    │ LocalStorage │
                                    │  永続化      │
                                    └──────────────┘
```

---

## 5. 動作環境

### 5.1 対応ブラウザ

| ブラウザ | バージョン | 対応状況 |
|----------|-----------|----------|
| Google Chrome | 90以上 | ○ 完全対応 |
| Mozilla Firefox | 88以上 | ○ 完全対応 |
| Microsoft Edge | 90以上 | ○ 完全対応 |
| Safari | 14以上 | ○ 完全対応 |
| Internet Explorer | - | × 非対応 |

### 5.2 必要な機能

| 機能 | 用途 | フォールバック |
|------|------|---------------|
| CSS Custom Properties | テーマ管理 | なし（必須） |
| ES6 Modules | コード分割 | なし（必須） |
| LocalStorage | データ永続化 | sessionStorage |
| CSS Grid/Flexbox | レイアウト | なし（必須） |
| CSS calc() | 計算レイアウト | なし（必須） |

---

## 6. セキュリティ考慮事項

### 6.1 セキュリティ対策

| リスク | 対策 |
|--------|------|
| XSS攻撃 | innerHTML不使用、textContentのみ使用 |
| eval使用 | eval()禁止、独自パーサー実装 |
| 外部通信 | 外部APIへの通信なし |
| 機密データ | 保存データに機密情報を含めない |

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|------------|----------|--------|
| 2025-12-11 | 1.0 | 初版作成 | Claude Code |
